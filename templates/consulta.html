{% extends "layout.html"%}
{%block content%}
<!DOCTYPE html>
<html lang="es">
<body>
    <head>
        <title>Tabla de Pacientes</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    </head>

    <form>
        <input type="text" onkeyup="doSearch()" id="input-search" placeholder=" Flitrar por celuda ...">
    </form>
    <thead>
        <th colspan="2" scope="rowgroup" align="center">Datos del paciente</th>
    </thead>
    {% for paciente in pacientes %}
    <table class="table table-bordered" id="tabla-Paciente">

        <tr>
            <th>Tipo de Documento</th>
            <td>{{paciente[1]}}</td>
            <th>Documento</th>
            <td>{{paciente[0]}}</td>
        </tr>
        <tr>
            <th>Nombre</th>
            <td>{{paciente[2]}}</td>
            <th>Edad</th>
            <td>{{paciente[3]}}</td>
        </tr>
        <tr>
            <th>Género</th>
            <td>{{ paciente[4] }}</td>
            <th>Email</th>
            <td>{{ paciente[5]}}</td>
        </tr>
        <tr>
            <th>Dirección</th>
            <td>{{ paciente[6]}}</td>
            <th>Celular</th>
            <td>{{ paciente[7]}}</td>
        </tr>
        <tr>
            <th>EPS</th>
            <td>{{ paciente[8] }}</td>
            <th>Ocupación</th>
            <td>{{ paciente[9] }}</td>
        </tr>
        <tr>
            <th>Acompañante</th>
            <td>{{ paciente[10] }}</td>
            <th>Parentesco</th>
            <td>{{ paciente[11] }}</td>
            <th>Teléfono del Acompañante</th>
            <td>{{paciente[12] }}</td>
        </tr>

        <tr>
            <th>Motivo de Consulta</th>
            <td>{{ paciente[13] }}</td>
            <th>Última Revisión</th>
            <td>{{paciente[14]}}</td>
        </tr>
        <tr>
            <tbody>
                <th colspan="2" scope="rowgroup">Antecedentes Familiares</th>
            </tbody>
        </tr>
        <tr>
            <th>Diabetes</th>
            <td>{{paciente[15]}}</td>
            <th>Hipertensión</th>
            <td>{{paciente[16]}}</td>
        </tr>
        <tr>
            <th>Artritis</th>
            <td>{{paciente[17]}}</td>
            <th>Alergia</th>
            <td>{{paciente[18]}}</td>
        </tr>
        <tr>
            <th>Catarata</th>
            <td>{{paciente[19]}}</td>
            <th>Glaucoma</th>
            <td>{{paciente[20]}}</td>
        </tr>
        <tr>
            <th>Estrabismo</th>
            <td>{{paciente[21]}}</td>
            <th>Queratocono</th>
            <td>{{paciente[22]}}</td>
            <th>Otros</th>
            <td>{{paciente[23]}}</td>
        </tr>
        <tr>
            <tbody>
                <th colspan="2" scope="rowgroup">Antecedentes Personales</th>
            </tbody>
        </tr>
        <tr>
            <th>Diabetes</th>
            <td>{{paciente[24]}}</td>
            <th>Hipertensión</th>
            <td>{{paciente[25]}}</td>
        </tr>
        <tr>
            <th>Artritis</th>
            <td>{{paciente[26]}}</td>
            <th>Alergia</th>
            <td>{{paciente[27]}}</td>
        </tr>
        <tr>
            <th>Ulcera Gástrica</th>
            <td>{{paciente[28]}}</td>
            <th>Cirugía Refractiva</th>
            <td>{{paciente[29]}}</td>
        </tr>
        <tr>
            <th>Lentes de Contacto</th>
            <td>{{paciente[30]}}</td>
            <th>Otros</th>
            <td>{{paciente[31]}}</td>
            <th colspan="2" scope="rowgroup">Antecedentes Quirúrgicos</th>
            <th>Descripción</th>
            <td>{{paciente[32]}}</td>
        </tr>
        <tr>
            <th>Documento del Paciente</th>
            <td>{{paciente[33]}}</td>
        </tr>
        <tr>
            <th>Motivo de la Consulta</th>
            <td>{{paciente[34]}}</td>
            <th>Ultima Consulta</th>
            <td>{{paciente[35]}}</td>
        </tr>
        <tbody>
            <th colspan="2" scope="rowgroup" align="center">RX FINAL (Formulación)</th>
        </tbody>
        <tr>
            <tr>
                <th>Ojo Derecho</th>
                <th>Esfera</th>
                <td>{{paciente[36]}}</td>
                <th>Cilindro</th>
                <td>{{paciente[37]}}</td>
                <th>Eje</th>
                <td>{{paciente[38]}}</td>
                <th>DP</th>
                <td>{{paciente[39]}}</td>
                <th>VL20</th>
                <td>{{paciente[40]}}</td>
                <th>VP20</th>
                <td>{{paciente[41]}}</td>
                <th>ADD</th>
                <td>{{paciente[42]}}</td>
            </tr>
            <tr>
                <th>Ojo Izquierdo</th>
                <th>Esfera</th>
                <td>{{paciente[43]}}</td>
                <th>Cilindro</th>
                <td>{{paciente[44]}}</td>
                <th>Eje</th>
                <td>{{paciente[45]}}</td>
                <th>DP</th>
                <td>{{paciente[46]}}</td>
                <th>VL20</th>
                <td>{{paciente[47]}}</td>
                <th>VP20</th>
                <td>{{paciente[48]}}</td>
                <th>ADD</th>
                <td>{{paciente[49]}}</td>
            </tr>
        <tbody>
            <th colspan="2" scope="rowgroup">Formula Número</th>
        </tbody>
        <tr>
            <th>Tipo de Lente</th>
            <td>{{paciente[50]}}</td>
            <th>Montura</th>
            <td>{{paciente[51]}}</td>
            <th>Material</th>
            <td>{{paciente[52]}}</td>
            <th>Filtro</th>
            <td>{{paciente[53]}}</td>
            <th>Color</th>
            <td>{{paciente[54]}}</td>
            <th>Obeservación</th>
            <td>{{paciente[55]}}</td>
        </tr>
        <tr>
              <th>Documento del paciente</th>
            <td>{{paciente[56]}}</td>
        </tr>
        <tbody>
            <th colspan="2" scope="rowgroup">Cover Test (CT)</th>
        </tbody>
        <tr>
            <th>Visisón Lejana</th>
            <td>{{paciente[57]}}</td>
            <th>Visisón Proxima</th>
            <td>{{paciente[58]}}</td>
        </tr>
        <tr>
            <th>Ducciones OD</th>
            <td>{{paciente[59]}}</td>
            <th>Ducciones OI</th>
            <td>{{paciente[60]}}</td>
        </tr>
        <tr>
            <th>PPC OD</th>
            <td>{{paciente[61]}}</td>
            <th>PPC OI</th>
            <td>{{paciente[62]}}</td>
        </tr>
        <tbody>
            <th colspan="2" scope="rowgroup">OFTALMOSCOPIA</th>
        </tbody>
        <tr>
            <th>Ojo Derecho</th>
            <td>{{paciente[63]}}</td>
            <th>Ojo Izquierdo</th>
            <td>{{paciente[64]}}</td>
        </tr>
    <tbody>
        <th colspan="2" scope="rowgroup">QUERATOMETRIA</th>
    </tbody>
    <tr>
        <th>Ojo Derecho</th>
        <td>{{paciente[65]}}</td>
        <th>Ojo Izquierdo</th>
        <td>{{paciente[66]}}</td>
    </tr>
    <tbody>
        <th colspan="2" scope="rowgroup">REFACTROMETRIA</th>
    </tbody>
    <tr>
        <th>Ojo Derecho</th>
        <td>{{paciente[67]}}</td>
        <th>Ojo Izquierdo</th>
        <td>{{paciente[68]}}</td>
    </tr>
    <tbody>
        <th colspan="2" scope="rowgroup">RETINOSCOPIA</th>
    </tbody>
    <tr>
        <th>Ojo Derecho</th>
        <th>Esfera</th>
        <td>{{paciente[69]}}</td>
        <th>Cilindro</th>
        <td>{{paciente[70]}}</td>
        <th>Eje</th>
        <td>{{paciente[71]}}</td>
        <th>DP</th>
        <td>{{paciente[72]}}</td>
        <th>VL20</th>
        <td>{{paciente[73]}}</td>
        <th>VP20</th>
        <td>{{paciente[74]}}</td>
        <th>ADD</th>
        <td>{{paciente[75]}}</td>
    </tr>
    <tr>
        <th>Ojo Izquierdo</th>
        <th>Esfera</th>
        <td>{{paciente[76]}}</td>
        <th>Cilindro</th>
        <td>{{paciente[77]}}</td>
        <th>Eje</th>
        <td>{{paciente[78]}}</td>
        <th>DP</th>
        <td>{{paciente[79]}}</td>
        <th>VL20</th>
        <td>{{paciente[80]}}</td>
        <th>VP20</th>
        <td>{{paciente[81]}}</td>
        <th>ADD</th>
        <td>{{paciente[82]}}</td>
    </tr>
    <tr>
        <th>Documento del Paciente</th>
        <td>{{paciente[83]}}</td>
    </tr>
</table>
    <a href="/editar/{{ paciente[0] }}" class="btn btn-primary">Editar</a> |
    <a href="/eliminar/{{ paciente[0] }}" class="btn btn-danger">Eliminar</a>

              
    {%endfor%}

    
</body>

<button id="mybutton" class="btn btn-primary">Regresar</button>
<button type="button" class="btn btn-success" onclick="imprimirDatos()">Imprimir</button>
   <script type="text/javascript">
        document.getElementById("mybutton").onclick = function () {
            location.href = "/index";  // Redirige a la página de inicio de la aplicación
        }

        function doSearch() {
            const tableReg = document.getElementById('tabla-Paciente');
            const searchText = document.getElementById('input-search').value.toLowerCase();
            let total = 0;

            for (let i = 1; i < tableReg.rows.length; i++) {
                if (tableReg.rows[i].classList.contains("noSearch")) {
                    continue;
                }
                let found = false;
                const cellsOfRow = tableReg.rows[i].getElementsByTagName('td');
                for (let j = 0; j < cellsOfRow.length && !found; j++) {
                    const compareWith = cellsOfRow[j].innerHTML.toLowerCase();
                    if (searchText.length == 0 || compareWith.indexOf(searchText) > -1) {
                        found = true;
                        total++;
                    }
                }
                if (found) {
                    tableReg.rows[i].style.display = '';
                } else {
                    tableReg.rows[i].style.display = 'none';
                }
            }

            const lastTR = tableReg.rows[tableReg.rows.length - 1];
            const td = lastTR.querySelector("td");

            lastTR.classList.remove("hide", "red");

            if (searchText == "") {
                lastTR.classList.add("hide");
            } else if (total) {
                td.innerHTML = "Se ha encontrado " + total + " coincidencia" + ((total > 1) ? "s" : "");
            } else {
                lastTR.classList.add("red");
                td.innerHTML = "No se han encontrado coincidencias";
            }
        }

        // imprimir datos del paciente
        function imprimirDatos() {
            console.log("Imprimiendo datos...");
            obtenerdatos();
            var tablaPaciente = document.getElementById('tabla-Paciente').outerHTML;

            var ventanaImpresion = window.open('', '_blank');
            ventanaImpresion.document.write('<html><head><title>Imprimir Datos</title></head><body>');
            ventanaImpresion.document.write(tablaPaciente);
            ventanaImpresion.document.write('</body></html>');
            ventanaImpresion.document.close();

            // Iniciar el diálogo de impresión
            ventanaImpresion.print();
        }

        // Asegúrate de que la función obtenerdatos() esté definida
        function obtenerdatos() {
            console.log("Obteniendo datos...");
            // ... lógica para obtener datos ...
        }
    </script>

</html>
{%endblock%}